{"version":3,"sources":["../../../../src/components/ui/card.tsx","../../../../src/lib/services/prep-service.ts","../../../../src/app/%28authenticated%29/projects/%5Bid%5D/prep/page.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n","import { getAiClient } from \"@/lib/ai/client\";\nimport {\n  CommitmentsRepository,\n  EntriesRepository,\n  ProjectsRepository,\n} from \"@/lib/repositories\";\n\nexport class PrepService {\n  constructor(\n    private readonly projectsRepo = new ProjectsRepository(),\n    private readonly entriesRepo = new EntriesRepository(),\n    private readonly commitmentsRepo = new CommitmentsRepository(),\n  ) {}\n\n  async generateBriefing(userId: string, projectId: string) {\n    const project = await this.projectsRepo.findById(userId, projectId);\n    if (!project) {\n      return null;\n    }\n\n    const [entries, commitments] = await Promise.all([\n      this.entriesRepo.listByProject(userId, projectId, {\n        kinds: [\"meeting\", \"update\", \"decision\"],\n      }),\n      this.commitmentsRepo.listCommitments(userId, {\n        projectId,\n        statuses: [\"open\"],\n      }),\n    ]);\n\n    const aiClient = getAiClient();\n    const aiResult = await aiClient.generatePrepBriefing({\n      projectName: project.name,\n      entries: entries.slice(0, 10).map((entry) => ({\n        occurredAt: entry.occurredAt?.toISOString() ?? \"\",\n        kind: entry.kind,\n        content: entry.aiSummary ?? entry.rawContent ?? entry.title,\n      })),\n      commitments: commitments.map((commitment) => ({\n        title: commitment.title,\n        direction: commitment.direction,\n        dueDate: commitment.dueDate?.toISOString(),\n        counterparty: commitment.counterparty ?? undefined,\n        status: commitment.status,\n      })),\n    });\n\n    return {\n      project,\n      entries,\n      commitments,\n      briefing: aiResult,\n    };\n  }\n}\n\n","import { notFound, redirect } from \"next/navigation\";\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { PrepService } from \"@/lib/services/prep-service\";\nimport { getCurrentSession } from \"@/lib/auth/session\";\n\ntype Params = {\n  id: string;\n};\n\nconst prepService = new PrepService();\n\nexport default async function PrepPage({ params }: { params: Params }) {\n  const session = await getCurrentSession();\n  if (!session?.user?.id) {\n    redirect(\"/auth/signin\");\n  }\n\n  const data = await prepService.generateBriefing(session.user.id, params.id);\n\n  if (!data) {\n    notFound();\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <p className=\"text-sm text-muted-foreground\">Prep</p>\n        <h1 className=\"text-3xl font-semibold\">{data.project.name}</h1>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Briefing</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"whitespace-pre-line text-sm text-muted-foreground\">{data.briefing.briefing}</p>\n          <ul className=\"mt-4 list-disc pl-4 text-sm\">\n            {data.briefing.talkingPoints.map((point) => (\n              <li key={point}>{point}</li>\n            ))}\n          </ul>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Outstanding commitments</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {data.commitments.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">No open commitments.</p>\n          ) : (\n            data.commitments.map((commitment) => (\n              <div key={commitment.id} className=\"rounded-lg border p-3\">\n                <p className=\"font-medium\">{commitment.title}</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {commitment.direction === \"i_owe\" ? \"You owe\" : \"Waiting for\"} Â·{\" \"}\n                  {commitment.counterparty ?? \"Unassigned\"}\n                </p>\n              </div>\n            ))\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}